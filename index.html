<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <!-- üÜï –ú–µ—Ç–∞-—Ç–µ–≥ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZZZ Player - Responsive</title>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    
    <style>
        /* CSS –æ—Å—Ç–∞–ª—Å—è –ø–æ—á—Ç–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, –¥–æ–±–∞–≤–∏–ª—Å—è —Ç–æ–ª—å–∫–æ wrapper */
        body {
            background-color: #121212; display: flex;
            justify-content: center; align-items: center; height: 100vh;
            margin: 0; overflow: hidden; font-family: sans-serif;
            user-select: none; -webkit-user-select: none;
        }

        /* üÜï –ù–æ–≤—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä-–æ–±–µ—Ä—Ç–∫–∞ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è */
        .player-wrapper {
            position: relative;
            /* –†–∞–∑–º–µ—Ä—ã –±–∞–∑–æ–≤–æ–≥–æ –º–∞–∫–µ—Ç–∞ (–ø–ª–µ–µ—Ä + –∫–Ω–æ–ø–∫–∞) */
            width: 550px;
            height: 730px; 
            /* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–ª–∞–≤–Ω–æ—Å—Ç—å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è */
            transform-origin: center top;
            transition: transform 0.2s ease-out;
        }

        .player-container { position: relative; width: 100%; height: 650px; }
        .layer { position: absolute; left: 0; width: 100%; pointer-events: none; }
        .bg-layer { top: 0; z-index: 1; }
        .deck-layer { bottom: 0; z-index: 3; }
        .disc-wrapper {
            position: absolute; width: 100%; z-index: 2; top: 105px;
            display: flex; justify-content: center;
        }
        .disc-img {
            width: 83%; border-radius: 50%;
            transition: transform 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        .player-container.playing .disc-img { animation: spin 6s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .led-group {
            position: absolute; z-index: 4; bottom: 242px; left: 74px;
            gap: 10px; display: flex; pointer-events: none;
        }
        .led {
            width: 8px; height: 8px; border-radius: 50%; background: #2a0a0a;
            transition: 0.2s; box-shadow: inset 0 0 2px #000;
        }
        .player-container.powered .led.power-led { background: #ffaa00; box-shadow: 0 0 8px #ffaa00; }
        .player-container.playing .led.play-led { background: #ff3333; box-shadow: 0 0 8px #ff3333; }
        .screen-mask {
            position: absolute; z-index: 5; bottom: 65px; left: 50%; transform: translateX(-50%);
            width: 380px; height: 45px; background: rgba(0, 0, 0, 0.3);
            display: flex; align-items: center; overflow: hidden;
            border-radius: 4px; pointer-events: none; box-shadow: inset 0 0 10px rgba(0,0,0,0.8);
        }
        .screen-mask::after {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: repeating-linear-gradient(0deg, transparent 0px, transparent 2px, rgba(0, 0, 0, 0.3) 3px);
            pointer-events: none; z-index: 10;
        }
        .equalizer-bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; justify-content: space-around; align-items: flex-end;
            padding: 0 10px; box-sizing: border-box;
            opacity: 0; transition: opacity 0.5s; z-index: 1;
        }
        .player-container.playing .equalizer-bg { opacity: 0.6; }
        .eq-bar {
            width: 6px; height: 0%;
            background: repeating-linear-gradient( to top, #ffaa00 0px, #ffaa00 2px, transparent 2px, transparent 4px );
            filter: drop-shadow(0 0 2px #ffaa00);
            transition: height 0.08s linear;
        }
        .screen-content {
            position: relative; z-index: 2; width: 100%; opacity: 0;
            transition: opacity 0.5s; display: flex; align-items: center; height: 100%;
        }
        .player-container.powered .screen-content { opacity: 1; }
        .marquee {
            font-family: 'Share Tech Mono', monospace; font-size: 18px; color: #e0e0e0;
            white-space: nowrap; transform: translateX(100%);
            text-shadow: 2px 2px 0px #000, 0 0 10px rgba(255, 255, 255, 0.5);
        }
        .marquee.scrolling { animation: car-scroll 8s linear infinite; }
        @keyframes car-scroll { 0% { transform: translateX(100%); } 100% { transform: translateX(-150%); } }
        .progress-area {
            position: absolute; z-index: 25; bottom: 110px; left: 56.5%;
            transform: translateX(-50%); width: 265px; height: 15px; cursor: pointer;
        }
        .progress-fill {
            height: 60%; width: 0%; background: #ffaa00; box-shadow: 0 0 8px #ffaa00;
            opacity: 0.8; pointer-events: none; border-radius: 2px;
            transition: width 0.1s linear;
        }
        .progress-fill::after {
            content: ''; position: absolute; right: 0; top: 0; bottom: 0;
            width: 4px; background: #fff; box-shadow: 0 0 5px #fff;
        }
        .playlist-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(10, 10, 10, 0.95); display: flex; flex-direction: column;
            justify-content: center; padding: 0 15px;
            font-family: 'Share Tech Mono', monospace; font-size: 16px; color: #555;
            opacity: 0; transition: opacity 0.2s; z-index: 20;
        }
        .playlist-overlay.visible { opacity: 1; pointer-events: auto; }
        .track-item { padding: 4px 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; border-bottom: 1px solid #222; }
        .track-item.selected { color: #ffaa00; text-shadow: 0 0 8px rgba(255, 170, 0, 0.6); font-weight: bold; background: rgba(255, 170, 0, 0.1); }
        .track-item::before { content: " "; }
        .track-item.selected::before { content: "> "; }
        .btn-hitbox { position: absolute; z-index: 30; cursor: pointer; opacity: 0; }
        #btn-power { width: 40px; height: 25px; bottom: 234px; left: 13px; border-radius: 5px; }
        #btn-play { width: 50px; height: 50px; bottom: 208px; right: 54px; border-radius: 50%; }
        #btn-stop { width: 30px; height: 30px; bottom: 227px; right: 12px; border-radius: 50%; }
        #btn-enter { width: 70px; height: 10px; bottom: 160px; left: 58px; }
        #btn-menu { width: 70px; height: 10px; bottom: 160px; left: 130px; }
        #btn-home { width: 70px; height: 10px; bottom: 160px; left: 202px; }
        
        .upload-controls {
            /* üÜï –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –æ–±–µ—Ä—Ç–∫–∏ */
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
        }
        .upload-btn {
            background: #111; color: #ddd; border: 2px solid #ffaa00; padding: 10px 25px;
            font-family: 'Share Tech Mono', monospace; font-size: 18px; cursor: pointer;
            text-transform: uppercase; letter-spacing: 2px; transition: 0.3s;
            clip-path: polygon(10% 0, 100% 0, 100% 70%, 90% 100%, 0 100%, 0 30%);
        }
        .upload-btn:hover { background: #ffaa00; color: #000; box-shadow: 0 0 15px #ffaa00; }
        #file-input { display: none; }
    </style>
</head>
<body>

    <!-- üÜï –û–±–µ—Ä—Ç–∫–∞ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <div class="player-wrapper" id="player-wrapper">
        <div class="player-container" id="player">
            <img src="bg_card.png" class="layer bg-layer">
            <div class="disc-wrapper"><img src="disc.png" class="disc-img"></div>
            <img src="player_body.png" class="layer deck-layer">

            <div class="led-group">
                <div class="led power-led"></div>
                <div class="led play-led"></div>
                <div class="led play-led"></div>
            </div>
            
            <div class="progress-area" id="progress-container" title="Seek Time">
                <div class="progress-fill" id="progress-bar"></div>
            </div>

            <div class="screen-mask">
                <div class="equalizer-bg" id="equalizer"></div>
                <div class="screen-content" id="main-screen">
                    <div class="marquee" id="marquee-text">WAITING FOR DISCS...</div>
                </div>
                <div class="playlist-overlay" id="playlist-screen"></div>
            </div>

            <div id="btn-power" class="btn-hitbox" title="Power"></div>
            <div id="btn-play" class="btn-hitbox" title="Play"></div>
            <div id="btn-stop" class="btn-hitbox" title="Stop"></div>
            <div id="btn-enter" class="btn-hitbox" title="Prev/Sel"></div>
            <div id="btn-menu"  class="btn-hitbox" title="Menu"></div>
            <div id="btn-home"  class="btn-hitbox" title="Next/Scroll"></div>
        </div>

        <div class="upload-controls">
            <label for="file-input" class="upload-btn">Load Discs</label>
            <input type="file" id="file-input" multiple accept="audio/*">
        </div>
    </div>

    <audio id="audio" crossorigin="anonymous"></audio>

    <script>
    (function() {
        'use strict';
        
        // --- üÜï –õ–û–ì–ò–ö–ê –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–ò ---
        const playerWrapper = document.getElementById('player-wrapper');
        const BASE_WIDTH = 550; // –ë–∞–∑–æ–≤–∞—è —à–∏—Ä–∏–Ω–∞ –º–∞–∫–µ—Ç–∞
        const BASE_HEIGHT = 730; // –ë–∞–∑–æ–≤–∞—è –≤—ã—Å–æ—Ç–∞ (–ø–ª–µ–µ—Ä + –∫–Ω–æ–ø–∫–∞)

        function scalePlayer() {
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;

            // –°—á–∏—Ç–∞–µ–º –º–∞—Å—à—Ç–∞–± –ø–æ —à–∏—Ä–∏–Ω–µ –∏ –ø–æ –≤—ã—Å–æ—Ç–µ
            const scaleX = viewportWidth / BASE_WIDTH;
            const scaleY = viewportHeight / BASE_HEIGHT;

            // –í—ã–±–∏—Ä–∞–µ–º –Ω–∞–∏–º–µ–Ω—å—à–∏–π –º–∞—Å—à—Ç–∞–±, —á—Ç–æ–±—ã –ø–ª–µ–µ—Ä –≤—Å–µ–≥–¥–∞ –ø–æ–º–µ—â–∞–ª—Å—è —Ü–µ–ª–∏–∫–æ–º
            const scale = Math.min(scaleX, scaleY);

            // –ü—Ä–∏–º–µ–Ω—è–µ–º –º–∞—Å—à—Ç–∞–± –∫ –æ–±–µ—Ä—Ç–∫–µ
            playerWrapper.style.transform = `scale(${scale})`;
        }

        // Debounce, —á—Ç–æ–±—ã –Ω–µ –≤—ã–∑—ã–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–æ
        function debounce(func, delay) {
            let timeout;
            return function(...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), delay);
            };
        }

        const debouncedScalePlayer = debounce(scalePlayer, 100);

        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞
        window.addEventListener('load', scalePlayer);
        window.addEventListener('resize', debouncedScalePlayer);

        // --- –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –ø–ª–µ–µ—Ä–∞ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ---
        const NUM_BARS = 24;
        const quotesPool = [
            "Fierce tigers prowl Yunkui Summit!", "Proxy, are you ready for the Hollow?", "Don't get lost in the static.",
            "Bangboo reporting for duty!", "Signal stablized. Connection secure.", "Wipeout! That was intense."
        ];
        
        const state = {
            tracks: [], isPowered: false, isPlaying: false, isMenuOpen: false,
            currentTrackIndex: 0, menuSelectionIndex: 0, showQuoteNext: false,
            audioContext: null, analyser: null, sourceNode: null, dataArray: null,
            isApiInitialized: false, animationFrameId: null
        };

        const dom = {
            player: document.getElementById('player'), audio: document.getElementById('audio'),
            marqueeText: document.getElementById('marquee-text'), mainScreen: document.getElementById('main-screen'),
            playlistScreen: document.getElementById('playlist-screen'), fileInput: document.getElementById('file-input'),
            equalizer: document.getElementById('equalizer'), progressContainer: document.getElementById('progress-container'),
            progressBar: document.getElementById('progress-bar'), btnPower: document.getElementById('btn-power'),
            btnPlay: document.getElementById('btn-play'), btnStop: document.getElementById('btn-stop'),
            btnEnter: document.getElementById('btn-enter'), btnMenu: document.getElementById('btn-menu'),
            btnHome: document.getElementById('btn-home')
        };
        let eqBars;
        
        function initAudioApi() {
            if (state.isApiInitialized) return;
            state.audioContext = new (window.AudioContext || window.webkitAudioContext)();
            state.analyser = state.audioContext.createAnalyser();
            state.sourceNode = state.audioContext.createMediaElementSource(dom.audio);
            state.sourceNode.connect(state.analyser);
            state.analyser.connect(state.audioContext.destination);
            state.analyser.fftSize = 256;
            const bufferLength = state.analyser.frequencyBinCount;
            state.dataArray = new Uint8Array(bufferLength);
            state.isApiInitialized = true;
        }

        function visualize() {
            state.animationFrameId = requestAnimationFrame(visualize);
            state.analyser.getByteFrequencyData(state.dataArray);
            const step = Math.floor(state.dataArray.length / NUM_BARS);
            for (let i = 0; i < NUM_BARS; i++) {
                const barValue = state.dataArray[i * step];
                const percentHeight = (barValue / 255) * 100;
                eqBars[i].style.height = `${percentHeight}%`;
            }
        }

        function updateProgressBar() {
            const percent = (dom.audio.currentTime / dom.audio.duration) * 100;
            dom.progressBar.style.width = percent ? `${percent}%` : '0%';
        }
        
        function updateMarquee() {
            if (!state.isPlaying || state.tracks.length === 0) return;
            const track = state.tracks[state.currentTrackIndex];
            if (state.showQuoteNext) {
                dom.marqueeText.innerText = `"${track.quote}"`;
                dom.marqueeText.style.color = "#ffdd88";
            } else {
                dom.marqueeText.innerText = `TRACK ${state.currentTrackIndex + 1}: ${track.title}`;
                dom.marqueeText.style.color = "#e0e0e0";
            }
            state.showQuoteNext = !state.showQuoteNext;
        }

        function startMarquee() {
            dom.marqueeText.classList.add('scrolling');
            dom.marqueeText.innerText = `NOW PLAYING: ${state.tracks[state.currentTrackIndex].title}`;
            dom.marqueeText.style.color = "#e0e0e0";
            state.showQuoteNext = true;
        }

        function stopMarquee(msg) {
            dom.marqueeText.classList.remove('scrolling');
            void dom.marqueeText.offsetWidth;
            dom.marqueeText.style.transform = "translateX(0)";
            if (msg) dom.marqueeText.innerText = msg;
            dom.marqueeText.style.color = "#e0e0e0";
        }

        function renderPlaylist() {
            if (state.tracks.length === 0) {
                dom.playlistScreen.innerHTML = '<div class="track-item" style="text-align:center">NO DISCS LOADED</div>';
                return;
            }
            let html = '';
            const trackCount = state.tracks.length;
            const indices = trackCount < 3 ? Array.from({ length: trackCount }, (_, i) => i) : [ (state.menuSelectionIndex - 1 + trackCount) % trackCount, state.menuSelectionIndex, (state.menuSelectionIndex + 1) % trackCount ];
            indices.forEach(idx => {
                const isSelected = idx === state.menuSelectionIndex;
                html += `<div class="track-item ${isSelected ? 'selected' : ''}">${state.tracks[idx].title}</div>`;
            });
            dom.playlistScreen.innerHTML = html;
        }
        
        function toggleMenuUI() {
            if (state.isMenuOpen) {
                dom.playlistScreen.classList.add('visible');
                dom.mainScreen.style.opacity = '0';
                state.menuSelectionIndex = state.currentTrackIndex;
                renderPlaylist();
            } else {
                dom.playlistScreen.classList.remove('visible');
                dom.mainScreen.style.opacity = '1';
            }
        }
        
        function loadTrack(index) {
            if (state.tracks.length === 0) return;
            state.currentTrackIndex = (index + state.tracks.length) % state.tracks.length;
            dom.audio.src = state.tracks[state.currentTrackIndex].file;
            dom.progressBar.style.width = '0%';
            renderPlaylist();
            if (state.isPlaying) { stopMarquee(); setTimeout(startMarquee, 100); }
        }

        function playTrack() {
            if (state.tracks.length === 0 || !state.isPowered) return;
            if (state.audioContext && state.audioContext.state === 'suspended') { state.audioContext.resume(); }
            dom.audio.play();
            dom.player.classList.add('playing');
            state.isPlaying = true;
            startMarquee();
            visualize();
        }

        function stopPlayer() {
            dom.audio.pause(); dom.audio.currentTime = 0;
            dom.player.classList.remove('playing'); state.isPlaying = false;
            stopMarquee("STOPPED"); dom.progressBar.style.width = '0%';
            if (state.animationFrameId) cancelAnimationFrame(state.animationFrameId);
        }

        function bindEvents() {
            dom.audio.addEventListener('timeupdate', updateProgressBar);
            dom.audio.addEventListener('ended', () => { if (state.tracks.length > 0) { loadTrack(state.currentTrackIndex + 1); playTrack(); } });
            dom.marqueeText.addEventListener('animationiteration', updateMarquee);
            dom.progressContainer.addEventListener('click', (e) => {
                if (!state.isPowered || state.tracks.length === 0) return;
                dom.audio.currentTime = (e.offsetX / dom.progressContainer.clientWidth) * dom.audio.duration;
            });
            dom.fileInput.addEventListener('change', (e) => {
                const files = Array.from(e.target.files);
                if (files.length === 0) return;
                files.forEach(file => {
                    state.tracks.push({
                        title: file.name.replace(/\.[^/.]+$/, ""),
                        file: URL.createObjectURL(file),
                        quote: quotesPool[Math.floor(Math.random() * quotesPool.length)]
                    });
                });
                if (state.tracks.length > 0 && dom.audio.src === "") {
                    loadTrack(0); if (state.isPowered) stopMarquee("DISCS LOADED");
                }
            });
            
            dom.btnPower.addEventListener('click', () => {
                state.isPowered = !state.isPowered;
                if (state.isPowered) {
                    initAudioApi(); dom.player.classList.add('powered');
                    stopMarquee(state.tracks.length > 0 ? "SYSTEM READY" : "INSERT DISC");
                } else {
                    dom.player.classList.remove('powered'); stopPlayer();
                    state.isMenuOpen = false; toggleMenuUI(); stopMarquee(" ");
                }
            });
            dom.btnPlay.addEventListener('click', () => {
                if (!state.isPowered || state.tracks.length === 0) return;
                if (state.isPlaying) {
                    dom.audio.pause(); dom.player.classList.remove('playing'); state.isPlaying = false;
                    stopMarquee("PAUSED"); if (state.animationFrameId) cancelAnimationFrame(state.animationFrameId);
                } else { playTrack(); }
            });
            dom.btnStop.addEventListener('click', () => { if (state.isPowered) stopPlayer(); });
            dom.btnMenu.addEventListener('click', () => { if (!state.isPowered || state.tracks.length === 0) return; state.isMenuOpen = !state.isMenuOpen; toggleMenuUI(); });
            dom.btnHome.addEventListener('click', () => { 
                if (!state.isPowered || state.tracks.length === 0) return;
                if (state.isMenuOpen) { state.menuSelectionIndex = (state.menuSelectionIndex + 1) % state.tracks.length; renderPlaylist(); }
                else { loadTrack(state.currentTrackIndex + 1); if (state.isPlaying) playTrack(); }
            });
            dom.btnEnter.addEventListener('click', () => { 
                if (!state.isPowered || state.tracks.length === 0) return;
                if (state.isMenuOpen) { loadTrack(state.menuSelectionIndex); playTrack(); state.isMenuOpen = false; toggleMenuUI(); }
                else { loadTrack(state.currentTrackIndex - 1); if (state.isPlaying) playTrack(); }
            });
        }
        
        function init() {
            let barsHTML = '';
            for (let i = 0; i < NUM_BARS; i++) { barsHTML += '<div class="eq-bar"></div>'; }
            dom.equalizer.innerHTML = barsHTML;
            eqBars = dom.equalizer.children;
            bindEvents();
        }

        init();
    })();
    </script>
</body>
</html>
